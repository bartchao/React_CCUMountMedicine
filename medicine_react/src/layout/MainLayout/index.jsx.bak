import PropTypes from 'prop-types';
import { useEffect, useState, useCallback } from 'react';
import { useDispatch, useSelector } from 'react-redux';

// material-ui
import { Box, Toolbar, styled } from '@mui/material';
import { drawerWidth } from 'config';
// project import
import Drawer from 'components/LayoutComponents/Drawer';
import Footer from 'components/LayoutComponents/Footer/';
import { Profile, Localization, DeltaAppBar } from 'components/LayoutComponents/Header/';

import { toggleMenuAction } from 'store/modules/layout/actions/toggleMenu';

// ==============================|| MAIN LAYOUT ||============================== //

const HeaderContent = (
  <>
    <Profile />
    <Localization />
  </>
);
const Main = styled('main', { shouldForwardProp: (prop) => prop !== 'open' })(
  ({ theme, open }) => ({
    flexGrow: 1,
    display: 'flex',
    flexDirection: 'column',
    padding: theme.spacing(3),
    transition: theme.transitions.create('margin', {
      easing: theme.transitions.easing.sharp,
      duration: theme.transitions.duration.leavingScreen,
    }),
    ...(open && {
      transition: theme.transitions.create('margin', {
        easing: theme.transitions.easing.easeOut,
        duration: theme.transitions.duration.enteringScreen,
      }),
      marginLeft: `${drawerWidth}px`,
    }),
  }),
);

function MainLayout({ children }) {
  // const theme = useTheme();
  const dispatch = useDispatch();
  const { drawerOpen } = useSelector((state) => state.layout);
  const [open, setOpen] = useState(drawerOpen);
  const handleDrawerToggle = useCallback(
    () => {
      setOpen(!open);
      dispatch(toggleMenuAction(!open));
    },
    [open],
  );

  useEffect(() => {
    if (open !== drawerOpen) setOpen(drawerOpen);
  }, [drawerOpen]);
  return (
    <Box
      sx={{
        display: 'flex',
        width: '100%',
        flexDirection: 'column',
        minHeight: '100vh',
      }}
    >
      <DeltaAppBar showDrawer open={open} handleDrawerToggle={handleDrawerToggle}>
        {HeaderContent}
      </DeltaAppBar>
      <Drawer open={open} handleDrawerToggle={handleDrawerToggle} />
      <Toolbar />
      <Main open={open}>{children}</Main>
      <Footer />
    </Box>
  );
}

export default MainLayout;
MainLayout.propTypes = {
  children: PropTypes.node,
};
